name: Setup Linux RDP with Chrome Remote Desktop

on:
  workflow_dispatch:  # Allows manual trigger from the GitHub Actions UI

jobs:
  setup-rdp:
    runs-on: ubuntu-latest
    steps:
      - name: Update and Install Dependencies
        run: |
          sudo apt update
          sudo apt install -y wget

      - name: Install Chrome Remote Desktop
        run: |
          wget https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb
          sudo apt install -y ./chrome-remote-desktop_current_amd64.deb

      - name: Install Desktop Environment (XFCE)
        run: |
          sudo DEBIAN_FRONTEND=noninteractive apt install -y xfce4 xfce4-goodies

      - name: Configure Chrome Remote Desktop
        run: |
          # Start the Chrome Remote Desktop host with the provided access code
          DISPLAY= /opt/google/chrome-remote-desktop/start-host \
          --code="4/0AVG7fiSvwohPNnfvEBODlcMVELAqBYDs_G9lyRL2ofVImGVOY65fEyAdXuBXmHSVCMaDsw" \
          --redirect-url="https://remotedesktop.google.com/_/oauthredirect" \
          --name="$(hostname)"

      - name: Set Remote Desktop Access Code
        run: |
          echo "Access Code: 123456"  # This is where you specify the 6-digit code (just for information, won't set it automatically)
          # You would replace this echo with the actual command to set the access code if needed
          
      - name: Enable Firewall Rule for RDP (if applicable)
        run: |
          sudo ufw allow 3389/tcp  # RDP Port
